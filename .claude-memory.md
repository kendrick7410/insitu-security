# Claude Memory - Projet In situ Security

**Date de création** : 2026-02-02
**Dernière mise à jour** : 2026-02-04
**Version** : 2.0 - Migration WebXR

---

## Résumé du projet

**Nom** : In situ Security
**Type** : Application WebAR (proof-of-concept)
**Emplacement** : `/home/jme/insitu-security`
**Statut** : ✅ Fonctionnel - Prêt pour test sur Android

### Objectif

Créer une application WebAR permettant de placer un objet 3D sur une surface horizontale réelle via un tap, en utilisant WebXR Hit Test API.

---

## ⚠️ CHANGEMENT MAJEUR (2026-02-04)

**8th Wall est en shutdown (28 Feb 2026)** - Impossible de créer de nouveaux comptes ou d'obtenir des clés API.

**Solution implémentée** : Migration vers **WebXR Device API native** (immersive-ar)
- Aucune clé API requise
- Pas de vendor lock-in
- Support natif dans Chrome Android
- Utilise ARCore directement

---

## Spécifications techniques

### Technologies utilisées

- **WebXR Device API** : Immersive AR native (hit-test, local-floor)
- **three.js** : Rendu 3D (v0.160.0) avec WebXRManager
- **GLTFLoader** : Chargement de modèles 3D (.glb / .gltf)
- **ARCore** : Backend AR (Google Play Services for AR)
- **Plateforme cible** : Android Chrome 79+ (mobile browser)

### Contraintes

- ✅ Frontend uniquement (pas de backend)
- ✅ Pas de persistence
- ✅ Pas de comptes utilisateurs
- ✅ Pas de tracking analytics
- ✅ Accès via URL HTTPS
- ✅ UI minimale avec bouton "Start AR"

---

## Structure des fichiers

```
insitu-security/
├── index.html              # Page principale avec bouton Start AR
├── package.json            # Configuration NPM
├── README.md               # Documentation utilisateur (WebXR)
├── .gitignore             # Exclusions Git
├── .claude-memory.md      # CE FICHIER - mémoire de Claude
├── css/
│   └── style.css          # Styles (start screen, loading, overlays)
├── js/
│   ├── config.js          # Configuration (modèle, reticle, shadow)
│   └── app.js             # Logique WebXR AR complète
└── models/
    ├── object.glb         # ✅ Modèle test cube (1.7KB)
    └── README.md          # Guide pour obtenir des modèles 3D
```

---

## Fonctionnalités implémentées

### 1. Interface utilisateur

- **Start screen** : Écran d'accueil avec bouton "Start AR"
- **Loading screen** : Écran de chargement avec spinner
- **Instructions overlay** : Instructions utilisateur (disparaît après 5s)
- **Error handling** : Affichage des erreurs avec bouton reload
- **Status text** : Indicateur d'état en temps réel
- **Tap hint** : Indicateur "Tap to place" avec animation pulse
- **Requirements text** : "Requires: Android Chrome + ARCore"

### 2. Logique WebXR (app.js)

**Initialisation :**
- Vérification support WebXR (`navigator.xr.isSessionSupported`)
- Initialisation three.js avec `renderer.xr.enabled = true`
- Bouton Start AR qui déclenche la session

**Session AR :**
- Requête session : `requestSession('immersive-ar', { requiredFeatures: ['hit-test', 'local-floor'] })`
- Setup WebGL layer : `XRWebGLLayer`
- Reference space : `local-floor`
- Hit test source : `requestHitTestSource({ space: viewerSpace })`

**Render loop :**
- `renderer.setAnimationLoop(render)`
- `frame.getHitTestResults(xrHitTestSource)`
- Mise à jour position reticle via `matrix.fromArray(hitPose.transform.matrix)`
- Reticle visible uniquement quand surface détectée

**Placement :**
- Event `select` (tap sur écran)
- Chargement modèle GLB via GLTFLoader
- Position objet à la matrice du reticle
- Shadow plane positionné sous l'objet
- Un seul placement (pas de placement multiple)

### 3. Configuration (config.js)

```javascript
CONFIG = {
  model: {
    path: 'models/object.glb',
    scale: 0.5,
    rotationY: 0
  },
  reticle: {
    color: 0x00ff00,
    size: 0.3,
    opacity: 0.8
  },
  shadow: {
    enabled: true,
    size: 2,
    opacity: 0.3,
    color: 0x000000
  },
  ui: {
    instructionsTimeout: 5000,
    showFPS: false
  }
}
```

### 4. Rendu réaliste

- **Éclairage** : AmbientLight (0.8) + DirectionalLight (0.6)
- **Shadow plane** : Plan transparent sous l'objet (ShadowMaterial)
- **Reticle** : RingGeometry vert sur les surfaces détectées

---

## État actuel : ✅ PRÊT POUR TEST

### Prérequis Android

1. **Appareil Android** avec support ARCore
   - Vérifier liste : https://developers.google.com/ar/devices

2. **Chrome Android** (version 79+)
   - Mettre à jour depuis Play Store

3. **Google Play Services for AR** (ARCore)
   - Installer depuis Play Store
   - Rechercher "Google Play Services for AR"

4. **Hébergement HTTPS**
   - Local : tunnel HTTPS (ngrok, localtunnel)
   - Production : GitHub Pages, Netlify, Vercel, Firebase

---

## Comment lancer le projet

### Développement local

```bash
cd /home/jme/insitu-security

# Lancer serveur HTTP
python3 -m http.server 8080
# ou
npx http-server -p 8080
```

### Créer tunnel HTTPS (REQUIS pour WebXR)

```bash
# Option 1 : localtunnel
npx localtunnel --port 8080

# Option 2 : ngrok
ngrok http 8080
```

### Tester sur Android

1. Ouvrir l'URL HTTPS du tunnel dans Chrome Android
2. Cliquer "Start AR"
3. Autoriser l'accès caméra
4. Scanner les surfaces horizontales (reticle vert apparaît)
5. Taper pour placer l'objet
6. L'objet apparaît avec une ombre

---

## Fichiers modifiés lors de la migration

| Fichier | Changements |
|---------|-------------|
| `index.html` | ❌ Supprimé scripts 8th Wall<br>✅ Ajouté écran "Start AR" |
| `css/style.css` | ✅ Ajouté styles start screen |
| `js/config.js` | ❌ Supprimé apiKey 8th Wall<br>✅ Ajouté config shadow plane |
| `js/app.js` | ❌ Supprimé tout code XR8<br>✅ Implémenté WebXR complet (410 lignes) |
| `models/object.glb` | ✅ Ajouté modèle test cube (1.7KB) |
| `README.md` | ✅ Documentation WebXR complète |

---

## Architecture WebXR

```
User clicks "Start AR"
    ↓
navigator.xr.requestSession('immersive-ar')
    ↓
Setup XRWebGLLayer + reference space
    ↓
requestHitTestSource (viewer space)
    ↓
Render loop (frame.getHitTestResults)
    ↓
Update reticle position on surfaces
    ↓
User taps → Event 'select'
    ↓
Load GLB model → Place at reticle position
    ↓
Show shadow plane under object
```

---

## Différences 8th Wall vs WebXR

| Aspect | 8th Wall (ancien) | WebXR (actuel) |
|--------|-------------------|----------------|
| Clé API | ❌ Requise (shutdown) | ✅ Aucune |
| Dashboard | ❌ Domain whitelist | ✅ Pas de config |
| Coût | $99-129/mois | ✅ Gratuit |
| Initialisation | XR8.run() | navigator.xr.requestSession() |
| Hit test | XR8 processCpuResult | frame.getHitTestResults() |
| Camera | Automatique | requestReferenceSpace() |
| Support | Vendor lock-in | Standard W3C |

---

## Commandes de test rapide

```bash
# Vérifier fichiers
ls -lh ~/insitu-security/models/

# Lancer serveur
cd ~/insitu-security && python3 -m http.server 8080

# Tunnel HTTPS
npx localtunnel --port 8080

# Git status (si besoin)
git status
```

---

## Ressources pour modèles 3D

- **glTF Sample Models** : https://github.com/KhronosGroup/glTF-Sample-Models
- **Sketchfab** : https://sketchfab.com/features/gltf (filtrer "Downloadable")
- **Poly Haven** : https://polyhaven.com/models
- **Quaternius** : https://quaternius.com/ (low-poly, parfait mobile)

**Critères modèle :**
- Format : `.glb` (préféré) ou `.gltf`
- Taille : < 2MB
- Polygones : < 50k triangles
- Textures : ≤ 1024x1024

---

## Décisions importantes

1. **Migration WebXR** : Pas de fallback 8th Wall, WebXR uniquement
2. **Pas de polyfill** : Pas de WebXR Polyfill, support natif uniquement
3. **Shadow plane** : ShadowMaterial au lieu de vraies ombres (performance)
4. **Un seul objet** : Placement unique, pas de reset/clear
5. **Hit test continu** : `requestHitTestSource` au lieu de hit test par frame

---

## Support navigateurs

| Navigateur | Plateforme | Support |
|------------|------------|---------|
| Chrome 79+ | Android | ✅ Complet |
| Chrome | Desktop | ⚠️ Pas d'AR (dev uniquement) |
| Safari | iOS | ❌ Pas de WebXR AR |
| Firefox | Any | ❌ Pas de WebXR AR |

---

## Prochaines étapes possibles

- [ ] Tester sur appareil Android réel
- [ ] Ajuster scale du modèle si besoin
- [ ] Ajouter un vrai modèle 3D (remplacer cube)
- [ ] Déployer sur GitHub Pages ou Netlify
- [ ] Optimiser modèle 3D (compression, textures)
- [ ] Ajouter placement multiple (optionnel)
- [ ] Ajouter rotation de l'objet avec gestures (optionnel)

---

## Bugs connus / Limitations

- **HTTPS obligatoire** : Ne fonctionne pas en HTTP
- **Android uniquement** : Pas de support iOS Safari
- **ARCore requis** : Certains appareils non supportés
- **Un seul objet** : Pas de placement multiple
- **Pas de persistance** : L'objet disparaît au refresh
- **Desktop limité** : Pas d'AR sur ordinateur (normal)

---

## Notes de l'utilisateur

- **Langue** : Français
- **Environnement** : Linux (Ubuntu)
- **Serveur** : /home/jme
- **Pas de tracking** : Projet indépendant, aucun analytics
- **8th Wall shutdown** : Migration réussie vers WebXR

---

**FIN DU MÉMO**

_Note : Ce fichier doit être lu au début de chaque session pour reprendre le contexte._
